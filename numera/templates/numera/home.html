{% extends 'numera/base.html' %}
{% block content %}
<h1>Accueil</h1>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form-group">
        <label for="file">Charger un fichier CSV :</label>
        <input type="file" name="file" id="file" class="form-control" required>
    </div>
    <button type="submit" class="btn btn-primary">Charger</button>
</form>

{% if columns %}
<form method="post" class="mt-4">
    {% csrf_token %}
    <div class="form-group">
        <label for="operation">Type d'opération :</label>
        <select name="operation" id="operation" class="form-control" required onchange="toggleColumns()">
            <option value="mean">Moyenne</option>
            <option value="median">Médiane</option>
            <option value="mode">Mode</option>
            <option value="std">Écart-Type</option>
            <option value="variance">Variance</option>
            <option value="range">Étendue</option>
        </select>
    </div>
    <div class="form-group">
        <label for="column">Colonne :</label>
        <select name="column" id="column" class="form-control" required>
            {% for col in numeric_columns %}
            <option value="{{ col }}" class="numeric">{{ col }}</option>
            {% endfor %}
            {% for col in categorical_columns %}
            <option value="{{ col }}" class="categorical">{{ col }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn btn-success">Calculer</button>
</form>
{% endif %}

{% if result is not None %}
<div class="mt-4 alert alert-info">
    <h4>Résultat :</h4>
    <p><strong>{{ operation|title }}</strong> de la colonne <strong>{{ column }}</strong> : {{ result }}</p>
</div>
{% endif %}

<script>
    function toggleColumns() {
        const operation = document.getElementById('operation').value;
        const columnOptions = document.getElementById('column').options;

        // Afficher ou masquer les colonnes en fonction de l'opération sélectionnée
        for (let option of columnOptions) {
            if (operation === "mode") {
                // Si l'opération est "Mode", afficher uniquement les colonnes qualitatives
                option.style.display = option.classList.contains('categorical') ? 'block' : 'none';
            } else {
                // Sinon, afficher uniquement les colonnes quantitatives
                option.style.display = option.classList.contains('numeric') ? 'block' : 'none';
            }
        }

        // Réinitialiser la sélection de la colonne
        document.getElementById('column').selectedIndex = 0;
    }
</script>
{% endblock %}
